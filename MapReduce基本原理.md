### Map Reduce 基本原理
Map Reduce由map阶段的分区，排序，组合，溢出写和reduce阶段的复制，归并，分组组成。
#### Map阶段
1. 首先将输入切割成小段送入map函数中，然后对输出的键值对默认按照键的哈希值分区，可以重写分区函数自定分区，一个分区对应一个reduce
2. 键值对默认按键的大小排序，可以重写排序函数，自定义排序。
3. 键值对首先存入内存数组中，当达到阈值时溢出写到磁盘中，此时会产生溢出写文件。
4. 当溢出写文件达到3个时，会自动调用组合函数。组合函数的作用是减少写到磁盘中的数据量。
#### Reduce阶段
1. 将Map结果按照分区复制到reduce进程中，map线程完成后，会向application master发送心跳，包含map线程和主机的映射。
reduce线程会不断轮询application master获取主机，从主机上复制对应自己分区的键值对。
2. 键值对已经排好序，reduce不断merge获取的键值对，有小变大，最后在内存中包含该分区所有排序的键值对
3. 键值对默认按照键的哈希值分组，相同键的值会存入一个迭代器中，即键值对变为键迭代器对，也是一个组。
4. 组中的键为排序的第一个键值对的键，其他键被抛弃。重写分组函数能自定义分组。
5. reduce函数的输入就是一个组，key为组的键，values为组的迭代器。
